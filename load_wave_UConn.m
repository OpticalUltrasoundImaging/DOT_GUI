function [amp74,amp78,amp80,amp83,pha74,pha78,pha80,pha83]=load_wave_UConn(bgdata,source,detect,sddist_matrix)

% channel=detect+1;
% s_total = size(bgdata,1)/channel;  %number of one set data

data_74=bgdata(1:4608,1:detect+1);  %512*9=4608, bgdata=[4 wave * 512 points * 9 source, 14 detector + 1 ref + unused]
data_78=bgdata(4609:4608*2,1:detect+1);
data_80=bgdata(4608*2+1:4608*3,1:detect+1);
data_83=bgdata(4608*3+1:4608*4,1:detect+1);

for i=1:source
    eval(['data74_s',num2str(i),'=data_74(512*(',num2str(i),'-1)+1:512*',num2str(i),',1:detect+1);']);
    eval(['data78_s',num2str(i),'=data_78(512*(',num2str(i),'-1)+1:512*',num2str(i),',1:detect+1);']);
    eval(['data80_s',num2str(i),'=data_80(512*(',num2str(i),'-1)+1:512*',num2str(i),',1:detect+1);']);
    eval(['data83_s',num2str(i),'=data_83(512*(',num2str(i),'-1)+1:512*',num2str(i),',1:detect+1);']);
end


%  compute the original amplitude and phase for every s-d measurement
for ii=1:source
    eval(['ref=data74_s',num2str(ii),'(:,15);']);
    ref=ref-mean(ref);
    ref_h = hilbert(ref);
    ref_phase=mean(unwrap(angle(ref_h)));
   
    for jj=1:detect
        eval(['wv=data74_s',num2str(ii),'(:,',num2str(jj),');'])
        wv_h=hilbert(wv);
        amp = mean(abs(wv_h));
        phase= mean(unwrap(angle(wv_h)));
        amp74(ii,jj)=amp/1000;   %convert from mV to V 
        %pha74(ii,jj)=mod(phase-ref_phase, 2*pi);
        %pha74(ii,jj)=phase;
        % pha74(ii,jj)=ref_phase-phase;
         pha74(ii,jj)=mod(ref_phase-phase,2*pi);
       %pha74(ii,jj)=phase-ref_phase;
    end
end

for ii=1:source
    eval(['ref=data78_s',num2str(ii),'(:,15);']);
    ref=ref-mean(ref);
    ref_h = hilbert(ref);
    ref_phase=mean(unwrap(angle(ref_h)));
   
    for jj=1:detect
        eval(['wv=data78_s',num2str(ii),'(:,',num2str(jj),');'])
        wv_h=hilbert(wv);
        amp = mean(abs(wv_h));
        phase= mean(unwrap(angle(wv_h)));
        amp78(ii,jj)=amp/1000;   %convert from mV to V 
        %pha78(ii,jj)=mod(phase-ref_phase, 2*pi);
         pha78(ii,jj)=mod(ref_phase-phase,2*pi);
        %pha78(ii,jj)=ref_phase-phase;
        %pha78(ii,jj)=phase-ref_phase;
    end
end

for ii=1:source
    eval(['ref=data80_s',num2str(ii),'(:,15);']);
    ref=ref-mean(ref);
    ref_h = hilbert(ref);
    ref_phase=mean(unwrap(angle(ref_h)));
   
    for jj=1:detect
        eval(['wv=data80_s',num2str(ii),'(:,',num2str(jj),');'])
        wv_h=hilbert(wv);
        amp = mean(abs(wv_h));
        phase= mean(unwrap(angle(wv_h)));
        amp80(ii,jj)=amp/1000;   %convert from mV to V 
        %pha80(ii,jj)=mod(phase-ref_phase, 2*pi);
         pha80(ii,jj)=mod(ref_phase-phase,2*pi);
        %pha80(ii,jj)=ref_phase-phase;
        %pha80(ii,jj)=phase-ref_phase;
    end
end

for ii=1:source
    eval(['ref=data83_s',num2str(ii),'(:,15);']);
    ref=ref-mean(ref);
    ref_h = hilbert(ref);
    ref_phase=mean(unwrap(angle(ref_h)));
   
    for jj=1:detect
        eval(['wv=data83_s',num2str(ii),'(:,',num2str(jj),');'])
        wv_h=hilbert(wv);
        amp = mean(abs(wv_h));
        phase= mean(unwrap(angle(wv_h)));
        amp83(ii,jj)=amp/1000;   %convert from mV to V 
        %pha83(ii,jj)=mod(phase-ref_phase, 2*pi);
         pha83(ii,jj)=mod(ref_phase-phase,2*pi);
        %pha83(ii,jj)=ref_phase-phase;
        %pha83(ii,jj)=phase-ref_phase;
    end
end

CTable=[-2.9652,0.2948,2.8544,-0.4064,0.9720,0.9318,0.9106,1.0190,0,0,0,0
-1.2556,1.8978,-1.8702,1.6223,0.8826,0.8357,0.8258,0.8267,0,0,0,0
-1.3549,2.1336,-1.7541,1.9972,0.7302,0.5950,0.6191,0.5152,2.0,2.0,2.0,2.0
-1.1586,2.0445,-1.7289,1.7487,0.8578,0.8077,0.8062,0.7977,0,0,0,0
-1.5861,1.7857,-2.0537,1.5679,0.7886,0.6646,0.6772,0.6020,0,0,0,0
-2.2751,1.1706,-2.6865,1.0123,0.7097,0.5834,0.5983,0.5105,0,0,0,0
-2.8352,0.5615,3.0389,0.3853,0.8526,0.7332,0.7395,0.6678,0,0,0,0
-2.0252,1.1514,-2.6376,0.9459,0.9465,0.9002,0.8903,0.8646,0,0,0,0
-2.4944,0.9205,-2.9285,0.7943,0.7222,0.6050,0.6190,0.5243,0,0,0,0
-0.8007,2.5548,-1.2511,2.4147,0.7224,0.6115,0.6169,0.5328,0,0,0,0
-0.8728,2.5134,-1.3471,2.3149,0.8211,0.6956,0.7111,0.6327,0,0,0,0
-2.5550,0.5936,3.0734,0.3146,0.8567,0.8077,0.8040,0.7906,0,0,0,0
2.3062,-0.4894,1.8861,-0.5777,0.7965,0.6757,0.6994,0.5988,0,0,0,0
-1.6752,1.6167,-2.3117,1.2598,0.7936,0.7096,0.7407,0.6968,0,0,0,0];

cross_74=CTable(:,1)';
cross_78=CTable(:,2)';
cross_80=CTable(:,3)';
cross_83=CTable(:,4)';

slope_74=CTable(:,5)';
slope_78=CTable(:,6)';
slope_80=CTable(:,7)';
slope_83=CTable(:,8)';


cro_74=CTable(:,9)';
cro_78=CTable(:,10)';
cro_80=CTable(:,11)';
cro_83=CTable(:,12)';

% %phase adjust
%  cross_74=[-0.1385	-0.7652	1.3197	1.1501	2.8862	-0.3428	-0.4548	1.6046	-0.8191	1.455	2.2615	-2.0107	1.6406	1.2764
% -0.0942	-0.566	1.1678	1.2674	2.8785	-0.3739	-0.3442	1.4508	-0.7498	1.3719	2.2393	-1.9359	2.0554	1.051
% -0.1136	-0.4572	1.3025	1.3508	2.8851	-0.3987	-0.2971	1.5437	-0.7739	1.5941	2.2059	-1.9531	1.7684	1.0344
% -0.1622	-0.6263	1.1638	1.235	2.8003	-0.3533	-0.2498	1.4259	-0.7616	1.5732	2.1042	-1.9888	1.7051	0.9896
% -0.4816	-0.8795	0.9942	0.8881	2.6051	-0.5646	-0.6105	1.1664	-0.9857	1.3461	1.8465	-2.3217	1.3981	0.7896
% 0.0783	-0.29	1.5854	1.4357	3.0324	-0.0817	-0.0335	1.7186	-0.7403	1.8301	2.3079	-1.7383	1.8661	1.2751
% 0.1905	-0.2866	1.5877	1.5908	3.1548	0.1119	0.1183	1.7816	-0.3694	1.879	2.3118	-1.7145	1.9916	1.1313
% 0.3622	-0.2494	1.5094	1.6199	3.2111	0.018	0.2038	1.7868	-0.6111	1.9518	2.3811	-1.786	1.9244	1.1956
% 0.2237	-0.2837	1.7172	1.4549	3.1504	0.1555	0.1811	1.8403	-0.3278	1.9817	2.649	-1.6458	2.0083	1.5113
% ];
% 
% slope_74=[0.8402	0.8624	0.7828	0.7742	0.7461	0.8131	0.8173	0.7392	0.7311	0.7979	0.8602	0.7042	0.8378	0.7376
% 0.8338	0.8218	0.8184	0.7492	0.7477	0.8179	0.7944	0.7699	0.7179	0.8142	0.8627	0.6874	0.7612	0.7942
% 0.8437	0.8076	0.7979	0.7407	0.7548	0.8341	0.7956	0.7585	0.7332	0.7706	0.874	0.6952	0.8304	0.8076
% 0.8395	0.8275	0.8099	0.7502	0.7584	0.8084	0.7713	0.7704	0.7172	0.7627	0.8799	0.6887	0.8224	0.7976
% 0.8507	0.8258	0.7953	0.7737	0.7471	0.8016	0.7945	0.7747	0.714	0.7566	0.8818	0.7051	0.835	0.7861
% 0.8419	0.8093	0.778	0.7658	0.7666	0.8069	0.7837	0.7652	0.7733	0.763	0.8923	0.6912	0.8462	0.7961
% 0.8363	0.8279	0.794	0.7542	0.759	0.7868	0.7642	0.7685	0.7064	0.7721	0.9128	0.7041	0.8385	0.8446
% 0.8072	0.8258	0.8162	0.7489	0.7472	0.8098	0.752	0.7707	0.7645	0.7559	0.8971	0.7203	0.8504	0.829
% 0.7964	0.7995	0.7396	0.7504	0.735	0.7428	0.7194	0.7268	0.6712	0.7186	0.8016	0.6605	0.7991	0.7213
% ];
% 
% cross_78=[-2.9606	2.3761	-1.6898	-2.0357	0.0356	-3.1854	-3.2042	-1.41	2.4817	-1.6037	-0.8028	1.3539	-1.4548	-1.8298
% -2.9666	2.4094	-1.7313	-1.9931	-0.0454	-3.2385	-3.1521	-1.4699	2.5395	-1.5822	-0.7515	1.3215	-1.1589	-1.983
% -2.919	2.5011	-1.6807	-1.9773	0.0443	-3.1792	-3.1456	-1.5099	2.6012	-1.4121	-0.878	1.3184	-1.4722	-2.0216
% -2.9399	2.4147	-1.7468	-2.0439	0.0126	-3.2172	-3.1646	-1.5295	2.58	-1.4328	-0.8079	1.2538	-1.4236	-2.0614
% -3.2759	2.1887	-1.9776	-2.2805	-0.3181	-3.4695	-3.4537	-1.7602	2.3408	-1.7215	-1.1283	1.0376	-1.5922	-2.3334
% -2.6994	2.7319	-1.4618	-1.7379	0.1642	-2.9672	-2.9627	-1.2219	2.7456	-1.2363	-0.6448	1.5244	-1.3001	-1.7641
% -2.6262	2.7461	-1.3493	-1.7439	0.4152	-2.8257	-2.8295	-1.1875	2.921	-1.1249	-0.5557	1.4941	-1.1701	-1.8549
% -2.594	2.7939	-1.4078	-1.718	0.4118	-2.8305	-2.7926	-1.1463	2.8081	-1.0823	-0.5851	1.6333	-1.1918	-1.8075
% -2.6388	2.6688	-1.4208	-1.8247	0.2593	-2.8763	-2.8531	-1.159	2.8427	-1.1541	-0.4542	1.5712	-1.1889	-1.7163
% ];
% 
% slope_78=[0.6909	0.7959	0.6662	0.6949	0.6171	0.6632	0.6433	0.6215	0.6081	0.6882	0.7463	0.5596	0.7397	0.6232
% 0.6916	0.7872	0.6777	0.6873	0.6325	0.6754	0.6337	0.6364	0.6002	0.6823	0.7348	0.5672	0.6914	0.6671
% 0.6927	0.7808	0.6778	0.6932	0.6266	0.6729	0.6436	0.6524	0.5963	0.6535	0.767	0.5744	0.7661	0.6847
% 0.683	0.7843	0.6768	0.694	0.6177	0.6671	0.6339	0.6433	0.5885	0.6399	0.7349	0.572	0.7321	0.6726
% 0.699	0.7771	0.6711	0.6916	0.6341	0.667	0.6436	0.64	0.5874	0.6494	0.7513	0.5672	0.714	0.6777
% 0.6857	0.7709	0.6712	0.6853	0.6406	0.6694	0.6506	0.6347	0.6117	0.6548	0.7575	0.5743	0.7643	0.6692
% 0.6861	0.7854	0.6628	0.7033	0.6059	0.6573	0.6359	0.6436	0.5881	0.6487	0.7573	0.5939	0.755	0.7043
% 0.6847	0.7788	0.6799	0.702	0.6104	0.6609	0.6334	0.6375	0.618	0.6424	0.7643	0.5692	0.7572	0.6944
% 0.6633	0.7809	0.6553	0.6969	0.6172	0.6421	0.6137	0.6128	0.5812	0.632	0.707	0.5571	0.7291	0.6438
% ];
% 
% cross_80=[2.064	1.3722	-2.8706	-3.1226	-1.1361	1.8163	1.8361	-2.6298	1.3455	-2.7682	-1.9657	0.1525	-2.6694	-2.9957
% 2.0346	1.4337	-2.9377	-3.0941	-1.1722	1.7427	1.9142	-2.7191	1.4042	-2.8441	-1.9417	0.218	-2.3382	-3.2072
% 2.137	1.4417	-2.9068	-3.046	-1.1177	1.8391	1.962	-2.6504	1.4626	-2.6272	-2.0101	0.2111	-2.5825	-3.1459
% 2.0322	1.3978	-2.9521	-3.1478	-1.1675	1.8159	1.9129	-2.7706	1.4479	-2.6463	-1.9806	0.1012	-2.6777	-3.2432
% 1.7737	1.0972	-3.2243	-3.4145	-1.3744	1.4951	1.6182	-2.9932	1.1956	-2.8784	-2.381	-0.176	-2.874	-3.4986
% 2.2857	1.662	-2.6823	-2.885	-0.9284	2.0425	2.1616	-2.4649	1.6459	-2.3877	-1.8296	0.3581	-2.4523	-3.0252
% 2.4188	1.7214	-2.5934	-2.8201	-0.7886	2.2456	2.2586	-2.4131	1.7823	-2.3457	-1.7797	0.4284	-2.4	-2.9701
% 2.4426	1.7222	-2.6259	-2.8218	-0.7408	2.2038	2.3272	-2.3556	1.7395	-2.2828	-1.7656	0.4611	-2.3821	-2.9525
% 2.3534	1.6525	-2.6834	-2.919	-0.8617	2.1324	2.2944	-2.5364	1.6969	-2.3825	-1.7763	0.4347	-2.4634	-2.9257
% ];
% 
% slope_80=[0.7284	0.7714	0.6865	0.69	0.6376	0.7079	0.6817	0.6534	0.6239	0.7051	0.7641	0.5954	0.7689	0.643
% 0.7307	0.7515	0.6988	0.6813	0.6448	0.7177	0.6647	0.67	0.6139	0.7171	0.7547	0.5792	0.7092	0.695
% 0.722	0.765	0.704	0.6844	0.6425	0.711	0.6648	0.6669	0.6123	0.6805	0.7777	0.5876	0.7716	0.6946
% 0.7273	0.7569	0.6965	0.6899	0.6387	0.7004	0.6616	0.6808	0.6026	0.6682	0.7553	0.5972	0.7701	0.6955
% 0.7261	0.7631	0.7004	0.6942	0.6287	0.7137	0.6724	0.6736	0.6021	0.662	0.7828	0.5994	0.7562	0.6945
% 0.7284	0.7544	0.6942	0.6893	0.6422	0.7068	0.6659	0.6685	0.6175	0.669	0.7761	0.5986	0.7787	0.7066
% 0.7196	0.7638	0.6936	0.698	0.6351	0.686	0.6633	0.6754	0.6053	0.6773	0.784	0.5991	0.7868	0.7135
% 0.7165	0.7658	0.704	0.6998	0.6268	0.6982	0.6525	0.6666	0.6187	0.6655	0.7825	0.5933	0.7808	0.7069
% 0.709	0.7536	0.6906	0.6926	0.6258	0.6845	0.6293	0.6798	0.599	0.6633	0.7582	0.5735	0.7721	0.6738
% ];
% 
% cross_83=[-0.3414	-1.5471	0.7167	0.3089	2.5435	-0.7921	-0.7932	0.9273	-1.2771	0.954	1.7458	-2.5929	0.8684	0.6348
% -0.329	-1.4503	0.6969	0.389	2.4961	-0.687	-0.7067	0.8804	-1.227	0.9426	1.797	-2.6102	1.1796	0.5573
% -0.3345	-1.4393	0.7318	0.4494	2.579	-0.7153	-0.6449	0.8822	-1.1977	1.0393	1.6359	-2.432	0.9687	0.4319
% -0.3352	-1.5619	0.6565	0.3513	2.5375	-0.7318	-0.7455	0.7747	-1.1966	1.039	1.6996	-2.5644	0.8218	0.4301
% -0.6117	-1.7941	0.5083	0.0837	2.2401	-1.0052	-0.9607	0.5661	-1.4672	0.7767	1.4413	-2.8167	0.7555	0.2774
% -0.1386	-1.2362	0.9983	0.5856	2.7696	-0.4392	-0.4298	1.0763	-0.9823	1.326	1.9045	-2.3131	1.0926	0.6641
% 0.0492	-1.1567	1.0262	0.6484	2.8387	-0.3833	-0.3366	1.1328	-0.851	1.3571	1.9984	-2.2021	1.0966	0.7674
% -0.0124	-1.1861	1.0821	0.6538	2.8535	-0.349	-0.3142	1.1336	-0.8682	1.4	2.0209	-2.2175	1.1689	0.746
% -0.0984	-1.3061	0.9677	0.5227	2.738	-0.4596	-0.3554	1.0536	-0.9578	1.3178	1.9335	-2.3112	1.1125	0.7248
% ];
% 
% slope_83=[0.6153	0.7742	0.629	0.6727	0.5544	0.6251	0.6001	0.5955	0.5399	0.6123	0.6764	0.5303	0.728	0.5816
% 0.6149	0.7568	0.6368	0.6589	0.5653	0.6054	0.5822	0.603	0.5314	0.6141	0.6671	0.5353	0.6766	0.6081
% 0.6269	0.7657	0.6391	0.6564	0.5582	0.6212	0.58	0.6136	0.5366	0.6001	0.7063	0.5049	0.7307	0.6452
% 0.6109	0.7737	0.6392	0.6607	0.5498	0.6084	0.5894	0.6242	0.5232	0.5868	0.6794	0.5212	0.7391	0.6253
% 0.6161	0.7705	0.6167	0.6657	0.5611	0.6137	0.5818	0.6144	0.5285	0.5862	0.6784	0.5176	0.6984	0.6032
% 0.6249	0.7607	0.6227	0.6686	0.558	0.6023	0.5777	0.6128	0.5325	0.5785	0.6877	0.5228	0.7401	0.6344
% 0.6022	0.763	0.6325	0.6724	0.5606	0.609	0.5747	0.6211	0.5218	0.5882	0.6855	0.5115	0.7562	0.6287
% 0.6192	0.7724	0.6242	0.6739	0.5595	0.6053	0.5742	0.6228	0.5294	0.5832	0.6838	0.5199	0.7398	0.632
% 0.612	0.7725	0.6241	0.6742	0.561	0.6022	0.5541	0.6147	0.5231	0.5771	0.6767	0.5137	0.7267	0.61
% ];
% 
% cross_74(:,1)=cross_74(:,1)-1;
% cross_78(:,1)=cross_78(:,1)-1;
% cross_80(:,1)=cross_80(:,1)-1;
% cross_83(:,1)=cross_83(:,1)-1;
% 
% cross_74(:,2)=cross_74(:,2)-1;
% cross_78(:,2)=cross_78(:,2)-1;
% cross_80(:,2)=cross_80(:,2)-1;
% cross_83(:,2)=cross_83(:,2)-1;
% 
% cross_74(:,3)=cross_74(:,3)-1;
% cross_78(:,3)=cross_78(:,3)-1;
% cross_80(:,3)=cross_80(:,3)-1;
% cross_83(:,3)=cross_83(:,3)-1;
% 
% cross_74(:,4)=cross_74(:,4)-1;
% cross_78(:,4)=cross_78(:,4)-1;
% cross_80(:,4)=cross_80(:,4)-1;
% cross_83(:,4)=cross_83(:,4)-1;
% 
% %cross_80 adjusted on 7/28/17 by Feifei
% cross_80(:,7)=cross_80(:,4)+.3;
% cross_80(:,9)=cross_80(:,9)+.8;
% cross_80(:,10)=cross_80(:,10)+.5;
% cross_80(:,11)=cross_80(:,11)+.3;
% cross_80(:,13)=cross_80(:,13)+.3;
% cross_80(:,14)=cross_80(:,14)+.6;
% 
% cross_74(:,8)=cross_74(:,8)-1.5;
% cross_78(:,8)=cross_78(:,8)-1.5;
% cross_80(:,8)=cross_80(:,8)-1.5;
% cross_83(:,8)=cross_83(:,8)-1.5;
% 
%  cro_74=[1 0 1 0  0 0 0 0  0 0 0 0  0 0];
%  cro_78=[1 0 1 0  0 0 0 0  0 0 0 0  0 0];
%  %cro_80 adjusted on 7/28/17 by Feifei
%  cro_80=[1 0 1 0  0 0 -.3 0  -.8 -.5 -.3 0  -.3 -.6];
%  cro_83=[1 0 1 0  0 0 0 0  0 0 0 0  0 0];
 

% Phase adjustment
 for ii=1:source
    for jj=1:detect
        pha=pha74(ii,jj);
        temp=polyval([mean(slope_74(:,jj)) mean(cross_74(:,jj))],sddist_matrix(ii,jj));
        if pha>temp+pi
            pha74(ii,jj)=pha-2*pi;
        end
        if pha<temp-pi
            pha74(ii,jj)=pha+2*pi;
        end
        pha74(ii,jj)=pha74(ii,jj)-mean(cross_74(:,jj))+cro_74(jj);
    end
end

for ii=1:source
    for jj=1:detect
        pha=pha78(ii,jj);
        temp=polyval([mean(slope_78(:,jj)) mean(cross_78(:,jj))],sddist_matrix(ii,jj));
        if pha>temp+pi
            pha78(ii,jj)=pha-2*pi;
        end
        if pha<temp-pi
            pha78(ii,jj)=pha+2*pi;
        end
        pha78(ii,jj)=pha78(ii,jj)-mean(cross_78(:,jj))+cro_78(jj);
    end    
end

 for ii=1:source
    for jj=1:detect
        pha=pha80(ii,jj);
        temp=polyval([mean(slope_80(:,jj)) mean(cross_80(:,jj))],sddist_matrix(ii,jj));
        if pha>temp+pi
            pha80(ii,jj)=pha-2*pi;
        end
        if pha<temp-pi
            pha80(ii,jj)=pha+2*pi;
        end
        pha80(ii,jj)=pha80(ii,jj)-mean(cross_80(:,jj))+cro_80(jj);
    end
 end

 for ii=1:source
    for jj=1:detect
        pha=pha83(ii,jj);
        temp=polyval([mean(slope_83(:,jj)) mean(cross_83(:,jj))],sddist_matrix(ii,jj));
        if pha>temp+pi
            pha83(ii,jj)=pha-2*pi;
        end
        if pha<temp-pi
            pha83(ii,jj)=pha+2*pi;
        end
        pha83(ii,jj)=pha83(ii,jj)-mean(cross_83(:,jj))+cro_83(jj);
    end
 end
%  
 pha74=mod(pha74,2*pi);
 pha78=mod(pha78,2*pi);
 pha80=mod(pha80,2*pi);
 pha83=mod(pha83,2*pi);
%  
